blueprint:
  name: ðŸ“¦Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ Ð´Ð»Ñ Ð´Ð¸Ð¼Ð¼ÐµÑ€Ð° Yeelight
  domain: automation
  input:
    button_device:
      name: Ð¡ÐµÐ½ÑÐ¾Ñ€ Ð´Ð¸Ð¼Ð¼ÐµÑ€Ð°
      description: Ð¡ÐµÐ½ÑÐ¾Ñ€ Ð´Ð¸Ð¼Ð¼ÐµÑ€Ð°
      selector:
        entity:
    one_press_action:
      name: 1 Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ðµ
      description: Ð”ÐµÐ¹Ñ‚ÑÐ²Ð¸Ðµ Ð¿Ñ€Ð¸ 1 Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ð¸ ÐºÐ½Ð¾Ð¿ÐºÐ¸
      default: []
      selector:
        action:
    two_press_action:
      name: 2 Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ñ
      description: Ð”ÐµÐ¹Ñ‚ÑÐ²Ð¸Ðµ Ð¿Ñ€Ð¸ 2 Ð½Ð°Ð¶Ð°Ñ‚Ð¸ÑÑ… ÐºÐ½Ð¾Ð¿ÐºÐ¸
      default: []
      selector:
        action:
    three_press_action:
      name: 3 Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ñ
      description: Ð”ÐµÐ¹Ñ‚ÑÐ²Ð¸Ðµ Ð¿Ñ€Ð¸ 3 Ð½Ð°Ð¶Ð°Ñ‚Ð¸ÑÑ… ÐºÐ½Ð¾Ð¿ÐºÐ¸
      default: []
      selector:
        action:
    four_press_action:
      name: 4 Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ñ
      description: Ð”ÐµÐ¹Ñ‚ÑÐ²Ð¸Ðµ Ð¿Ñ€Ð¸ 4 Ð½Ð°Ð¶Ð°Ñ‚Ð¸ÑÑ… ÐºÐ½Ð¾Ð¿ÐºÐ¸
      default: []
      selector:
        action:
    five_press_action:
      name: 5 Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ð¹
      description: Ð”ÐµÐ¹Ñ‚ÑÐ²Ð¸Ðµ Ð¿Ñ€Ð¸ 5 Ð½Ð°Ð¶Ð°Ñ‚Ð¸ÑÑ… ÐºÐ½Ð¾Ð¿ÐºÐ¸
      default: []
      selector:
        action:
    hold_press_action:
      name: Ð´Ð¾Ð»Ð³Ð¾Ðµ Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ðµ
      description: Ð”ÐµÐ¹Ñ‚ÑÐ²Ð¸Ðµ Ð¿Ñ€Ð¸ Ð´Ð¾Ð»Ð³Ð¾Ð¼ Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ð¸ ÐºÐ½Ð¾Ð¿ÐºÐ¸
      default: []
      selector:
        action:
    dimmer_action:
      name: ÐºÑ€ÑƒÑ‡ÐµÐ½Ð¸Ðµ
      description: ÐºÑ€ÑƒÑ‡ÐµÐ½Ð¸Ðµ (count_bt)
      default: []
      selector:
        action:
    dimmer_hold_press_action:
      name: ÐºÑ€ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¸ Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ð¸
      description: ÐºÑ€ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¸ Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ð¸ (count_bt)
      default: []
      selector:
        action:
mode: parallel
max: 50
trigger:
  - platform: state
    entity_id:
      - !input button_device
    attribute: last_packet_id
condition: []
action:
  - variables:
      type_bt: "{{trigger.to_state.attributes.last_type_of_press}}"
      count_bt: >-
        {%set valu = trigger.to_state.attributes.dimmer_value%}
        {%if type_bt == "rotate left" or type_bt == "rotate left (pressed)"%}
          {{valu * (-1)}}
        {%else%}
          {{valu}}
        {%endif%}
  - choose:
      - conditions:
          - condition: template
            value_template: '{{type_bt == "long press" and count_bt == 1}}'
        sequence: !input hold_press_action
      - conditions:
          - condition: template
            value_template: '{{type_bt == "rotate right" or type_bt == "rotate left"}}'
        sequence: !input dimmer_action
      - conditions:
          - condition: template
            value_template: '{{type_bt == "rotate right (pressed)" or type_bt == "rotate left (pressed)"}}'
        sequence: !input dimmer_hold_press_action
      - conditions:
          - condition: template
            value_template: '{{type_bt == "short press"}}'
        sequence:
          - choose:
              - conditions:
                  - condition: template
                    value_template: '{{count_bt == 1}}'
                sequence: !input one_press_action
              - conditions:
                  - condition: template
                    value_template: '{{count_bt == 2}}'
                sequence: !input two_press_action
              - conditions:
                  - condition: template
                    value_template: '{{count_bt == 3}}'
                sequence: !input three_press_action
              - conditions:
                  - condition: template
                    value_template: '{{count_bt == 4}}'
                sequence: !input four_press_action
              - conditions:
                  - condition: template
                    value_template: '{{count_bt == 5}}'
                sequence: !input five_press_action
            default: []
    default: []
