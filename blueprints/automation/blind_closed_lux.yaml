blueprint:
  name: ü™ü–®—Ç–æ—Ä—ã –≤ –ø–æ–ª–æ—Å–∫—É –∫–æ–≥–¥–∞ –ø–æ—Ç–µ–º–Ω–µ–ª–æ –∏–ª–∏ –∑–∞–∫—Ä—ã—Ç—å –ø—Ä–∏ –ª–∞–º–ø–µ
  domain: automation
  input:
    target_cover:
      name: –®—Ç–æ—Ä—ã
      description: –®—Ç–æ—Ä—ã
      selector:
        target:
          entity:
            domain: cover
    entity_button:
      name: –ö–Ω–æ–ø–∫–∏ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –≤ –ø–æ–ª–æ—Å–∫—É
      description: –ö–Ω–æ–ø–∫–∏ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –≤ –ø–æ–ª–æ—Å–∫—É
      selector:
        target:
          entity:
            domain: button
    entity_light:
      name: –õ–∞–º–ø–∞
      description: –õ–∞–º–ø–∞ –≤ –∫–æ–º–Ω–∞—Ç–µ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤ –ø–æ–ª–æ—Å–∫—É –∏–ª–∏ –∑–∞–∫—Ä—ã—Ç—å
      selector:
        entity:
          domain: light
    light_on_off:
      name: –ó–∞–∫—Ä—ã—Ç—å –∏–ª–∏ –≤ –ø–æ–ª–æ—Å–∫—É –ø—Ä–∏ –ª–∞–º–ø–µ
      description: –ó–∞–∫—Ä—ã—Ç—å –∏–ª–∏ –≤ –ø–æ–ª–æ—Å–∫—É –ø—Ä–∏ –ª–∞–º–ø–µ
      default: true
      selector:
        boolean:
    prinud_close:
      name: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–∫—Ä—ã–≤–∞—Ç—å –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω –ø—Ä–∏–∑–Ω–∞–∫
      description: –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–≤–µ—Ç –∏ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–∫—Ä—ã–≤–∞—Ç—å –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω –ø—Ä–∏–∑–Ω–∞–∫
      selector:
        entity:
          domain: input_boolean
    shtory_zakrit:
      name: –û—Å–≤–µ—â–µ–Ω–Ω–æ—Å—Ç—å –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è —à—Ç–æ—Ä
      description: –û—Å–≤–µ—â–µ–Ω–Ω–æ—Å—Ç—å –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è —à—Ç–æ—Ä
      default: 40
      selector:
        number:
          min: 5
          max: 80
          unit_of_measurement: lx
          mode: slider
#max_exceeded: silent
variables:
  light_on_off: !input light_on_off
  entity_button_new: !input entity_button
  all_cover: "cover.{{entity_button_new.entity_id[0].split('.')[1].split('_')[0]}}_blind_all"
trigger:
  - platform: numeric_state
    entity_id: sensor.ulica_illuminance2
    for: '00:00:30'
    below: !input shtory_zakrit
  - platform: homeassistant
    event: start
  - platform: event
    event_type: automation_reloaded
  - platform: state
    entity_id: !input entity_light
    id: lampa
    to: ~
condition: 
  # - condition: numeric_state
  #   entity_id: sensor.ulica_illuminance2
  #   below: !input shtory_zakrit


  - condition: or
    conditions:
      # - condition: numeric_state
      #   entity_id: cover.{{entity_button}}_blind_all
      #   attribute: current_position
      #   below: '30'target_cover
      - condition: numeric_state
        entity_id: sensor.ulica_illuminance2
        below: !input shtory_zakrit


      - condition: template
        value_template: "{{state_attr(all_cover,'current_position') < 20 }}"



action:
  - choose:
      - conditions:
          - condition: or
            conditions:
              - condition: state
                entity_id: !input entity_light
                state: 'on'
              - condition: state
                entity_id: !input prinud_close
                state: 'on'
              - condition: template
                value_template: '{{ light_on_off == False }}'
        sequence:
          - service: cover.close_cover
            target: !input target_cover
    default:
      - service: button.press
        target: !input entity_button
  - delay:
      hours: 0
      minutes: 0
      seconds: 4
      milliseconds: 0
mode: queued
max: 20